"undefined"==typeof Workflow&&(Workflow={}),Workflow.Chaos={},Workflow.Chaos.stringChaos=function(a){var b,c,d,e=100*Math.random(),f=a.length;if(5>e)return"toString";if(25>e){for(c=Math.floor(Math.random()*f),b="",d=0;f>d;d++)d!=c&&(b+=a[d]);return b}if(50>e){for(c=Math.floor(Math.random()*f),b="",d=0;f>d;d++)b+=d!=c?a[d]:Math.floor(26*Math.random()).toString(36);return b}if(75>e){var g="';:{}[]*!`@#$%^&*()_=+-,.<>?\\/";for(c=Math.floor(Math.random()*f),b="",d=0;f>d;d++)b+=d!=c?a[d]:g[Math.floor(Math.random()*g.length)];return b}return Math.floor(1e4*Math.random())-5e3},Workflow.Chaos.numberChaos=function(a){var b=120*Math.random();return 20>b?a-Math.random():40>b?a+Math.random():60>b?a-Math.floor(100*Math.random()):80>b?a+Math.floor(100*Math.random()):100>b?a.toString():120>b?Workflow.Chaos.stringChaos(a.toString()):void 0},Workflow.Chaos.chaos=function(a){var b=100*Math.random();if(a=JSON.parse(JSON.stringify(a)),2>b)return null;if(4>b)return{};if(6>b)return(1e5*Math.random()).toString(36);if(8>b)return 1e5*Math.random();if(10>b)return Math.random();if(12>b)return 1*Math.random()<.5?!0:!1;if(14>b)return[];if(16>b)return[a];if(18>b)return JSON.stringify(a);if(20>b)return null;if(a instanceof Array||"object"==typeof a){b=100*Math.random();for(var c in a)b=100*Math.random(),5>b||(a[c]=Workflow.Chaos.chaos(a[c]));return a}return"string"==typeof a?Workflow.Chaos.stringChaos(a):"number"==typeof a?Workflow.Chaos.numberChaos(a):a},assert={equal:function(a,b){if(a!=b)throw new Error("Values did not match: "+JSON.stringify(a)+" "+JSON.stringify(b))},deepEqual:function(a,b){if(JSON.stringify(a)!=JSON.stringify(b))throw new Error("Values did not match: "+JSON.stringify(a)+" "+JSON.stringify(b))}},"undefined"==typeof Workflow&&(Workflow={}),Workflow.getProperty=function(a,b){if("undefined"==typeof a)return a;if(0===b.length)return a;var c,d;if(/^\[/.test(b)){if(c=/^\[[^\]]+\]/.exec(b),!c)return void 0;d=c[0].replace(/^\[/,"").replace(/\]$/,"");d=unescape(d),d=d.replace(/^[\'\"]/,"").replace(/[\'\"]$/,"")}else{if(c=/^[^.^\[^\]]+\.?/.exec(b),!c)return void 0;d=c[0].replace(/\.?$/,"")}return a.hasOwnProperty(d)?(a=a[d],b=b.substr(c[0].length).replace(/^\./,""),Workflow.getProperty(a,b)):void 0};var foo={a:2,b:{c:3,d:5,e:6,f:{a:1},k:[{a:1}]},"foo bar":22};assert.equal(Workflow.getProperty(foo,"a"),2),assert.equal(Workflow.getProperty(foo,"['b']['f']['a']"),1),assert.equal(Workflow.getProperty(foo,"b['f']['a']"),1),assert.equal(Workflow.getProperty(foo,"b.f['a']"),1),assert.equal(Workflow.getProperty(foo,"b.f.a"),1),assert.equal(Workflow.getProperty(foo,"b.f'a']"),void 0),assert.equal(Workflow.getProperty(foo,"b.f['a"),void 0),assert.equal(Workflow.getProperty(foo,"['b']['g']['a']"),void 0),assert.equal(Workflow.getProperty(foo,"['b']['f']['a'].k"),void 0),assert.equal(Workflow.getProperty(foo,"['b']['f']['a'].toString"),void 0),assert.equal(Workflow.getProperty(foo,"['foo bar']"),22),Workflow.extendTo=function(a,b){if(void 0===a)return b;var c=JSON.parse(JSON.stringify(a)),d=function(a,b){for(var c in b){var e=b[c];0===c.indexOf("-")&&e===!0?delete a[c.substr(1)]:null!==e&&"object"==typeof e&&"object"==typeof a[c]?d(a[c],b[c]):a[c]=e}};return d(c,b),c},assert.deepEqual(Workflow.extendTo({foo:4,bar:8},{"-foo":!0,bar:12,zak:77}),{bar:12,zak:77}),Workflow.resolve=function(a,b,c){if("string"==typeof b&&c===!0){var d=a.loadValue(b);if("undefined"!=typeof d)return d}if(b instanceof Array)return b.map(function(b){return Workflow.resolve(a,b)});if("object"==typeof b){for(var e in b){var f=b[e];b[e]=Workflow.resolve(a,f)}return b}if("string"==typeof b){var g=/^\#\{(.+)\}$/.exec(b);return g&&g.length>1?a.loadValue(g[1]):b}return b},Workflow.with=function(a,b){var c=b[0];if(!c instanceof Array)throw new Error("args must be an array");for(var d=1;d<b.length;d++)"string"==typeof c&&(c=a.loadValue(c)),"string"==typeof b[d]&&(b[d]=a.loadValue(b[d])),c=Workflow.extendTo(c,b[d]);return c=Workflow.resolve(a,c,!0)},"undefined"!=typeof module&&module.exports&&(module.exports=Workflow),Workflow.Script=function(a){if(this.type="Workflow.Script","string"==typeof a)this.name=a,this.tasks=[];else if("object"==typeof a){console.log("New script"),this.name=a.name,this.demands=a.demands||{},this.defaults=a.defaults||{},this.tasks=[];for(var b in a.tasks){if(!Workflow.Task[a.tasks[b].type])throw new Error("Unknown task of type:"+a.tasks[b].type);console.log("I'd create ",a.tasks[b].type);var c=new Workflow.Task[a.tasks[b].type](a.tasks[b]);this.tasks.push(c)}}},Workflow.Script.prototype.toJSON=function(){return{name:this.name,demands:this.demands,defaults:this.defaults,tasks:this.tasks.map(function(a){return a.toJSON()})}},Workflow.Script.prototype.fileFromURL=function(a){return{_fileFromURL:a}},Workflow.Script.prototype.validate=function(a){var b;for(b in this.defaults)"undefined"==typeof a.loadValue(b)&&a.saveValue(b,this.defaults[b]);if(this.demand)for(b in this.demand)if("undefined"==typeof a.loadValue(b))throw new Error("Missing required value for script: "+b)},Workflow.Script.prototype.default=function(a,b){this.defaults||(this.defaults={}),this.defaults[a]=b},Workflow.Script.prototype.demand=function(a,b){this.demands||(this.demands={}),this.demands[a]={desc:b}},Workflow.Script.prototype.asyncWait=function(a){var b=new Workflow.Task.AsyncWait(a);return this.tasks.push(b),b},Workflow.Script.prototype.times=function(a,b){var c=new Workflow.Task.Times(a,b);return this.tasks.push(c),c},Workflow.Script.prototype.forEach=function(a,b,c,d){var e=new Workflow.Task.ForEach(a,b,c,d);return this.tasks.push(e),e},Workflow.Script.prototype.do=function(a){var b=new Workflow.Task.Do(a);return this.tasks.push(b),b},Workflow.Script.prototype.until=function(a,b,c){var d=new Workflow.Task.Until(a,b,c);return this.tasks.push(d),d},Workflow.Script.prototype.use=function(a){var b=new Workflow.Task.Use(a);return this.tasks.push(b),b},Workflow.Script.prototype.get=function(a){var b=new Workflow.Task.Get(a);return this.tasks.push(b),b},Workflow.Script.prototype.post=function(a){var b=new Workflow.Task.Post(a);return this.tasks.push(b),b},Workflow.Script.prototype.put=function(a){var b=new Workflow.Task.Put(a);return this.tasks.push(b),b},Workflow.Script.prototype.delete=function(a){var b=new Workflow.Task.Delete(a);return this.tasks.push(b),b},Workflow.Script.prototype.describe=function(a){this.description=a},Workflow.Task=function(){return this.resolveWith=Workflow.with,this.data||(this.data={}),this.data.enableChaos&&this.chaos(),this.data.onSuccess&&(this.data.onSuccess=new Workflow.Script(this.data.onSuccess)),this.data.onComplete&&(this.data.onComplete=new Workflow.Script(this.data.onComplete)),this.data.onError&&(this.data.onError=new Workflow.Script(this.data.onError)),this},Workflow.Task.prototype.toJSON=function(){return this},Workflow.Task.prototype.async=function(a){return this.data.asyncGroup=a,this},Workflow.Task.prototype.run=function(a,b){a._onStartTask(this);var c=this,d=function(b,d,e,f){a._onCompleteTask(c,b,d,e);var g=0;if((e&&e.result===!0||!e&&d)&&c.data.onSuccess)g++,a.run(c.data.onSuccess,function(){return g--,0===g?f(b,d,e):void 0});else if((e&&e.result===!1||!e&&b)&&c.data.onError)g++,a.run(c.data.onError,function(){return g--,0===g?f(b,d,e):void 0});else if(0===g)return f(b,d,e)};"string"==typeof c.data.asyncGroup?(a.asyncGroups[c.data.asyncGroup]||(a.asyncGroups[c.data.asyncGroup]=0),a.asyncGroups[c.data.asyncGroup]++,c.execute(a,function(b,e,f){d(b,e,f,function(){a.asyncGroups[c.data.asyncGroup]--})}),b(null,null,null)):c.execute(a,function(a,c,e){d(a,c,e,b)})},Workflow.Task.prototype.execute=function(){throw new Error("Execute for this task is not implemented")},Workflow.Task.prototype.runTests=function(a,b,c,d,e){var f=[],g=!0;if(this.data.tests)for(var h in this.data.tests){var i=this.data.tests[h];if(!Workflow.Tests[i.what])throw new Error("Invalid test specified '"+i.what+"'");var j=Workflow.Tests[i.what](b,d,c,i,a,e);j.test=i,f.push(j),j.result===!1&&(g=!1)}return{result:g,results:f}},Workflow.replaceUndefined=function(a){if(a instanceof Object)for(var b in a)"undefined"==typeof a[b]?a["-"+b]=!0:a[b]instanceof Object&&Workflow.replaceUndefined(a[b])},Workflow.Task.prototype.with=function(){if(this.data.with=Array.prototype.slice.call(arguments),this.data.with instanceof Array)for(var a in this.data.with)Workflow.replaceUndefined(this.data.with[a]);return this},Workflow.Task.prototype.chaos=function(){var a=this.resolveWith;return this.data.enableChaos=!0,this.resolveWith=function(b,c){return Workflow.Chaos.chaos(a(b,c))},this},Workflow.Task.prototype.onComplete=function(a){var b=new Workflow.Script("onComplete");return a(b),this.data.onComplete=b,this},Workflow.Task.prototype.onSuccess=function(a){var b=new Workflow.Script("onSuccess");return a(b),this.data.onSuccess=b,this},Workflow.Task.prototype.onError=function(a){var b=new Workflow.Script("onError");return a(b),this.data.onError=b,this},Workflow.Task.prototype.describe=function(a){return this.data.description=a,this},Workflow.Task.prototype.addOperation=function(a){return this.data.tests||(this.data.tests=[]),this.data.tests.push(a),this},Workflow.Task.prototype.errorContains=function(a){return this.addOperation({value:a,what:"errorContains"})},Workflow.Task.prototype.errorIsNull=function(){return this.addOperation({what:"errorIsNull"})},Workflow.Task.prototype.noError=Workflow.Task.prototype.errorIsNull,Workflow.Task.prototype.errorIsNotNull=function(){return this.addOperation({what:"errorIsNotNull"})},Workflow.Task.prototype.hasError=Workflow.Task.prototype.errorIsNotNull,Workflow.Task.prototype.outputIsNull=function(){return this.addOperation({what:"outputIsNull"})},Workflow.Task.prototype.outputContains=function(a){return this.addOperation({what:"outputContains",value:a})},Workflow.Task.prototype.outputSameAs=Workflow.Task.prototype.outputContains,Workflow.Task.prototype.outputDoesNotContain=function(a){return this.addOperation({what:"outputDoesNotContain",value:a})},Workflow.Task.prototype.outputDoesntContain=Workflow.Task.prototype.outputDoesNotContain,Workflow.Task.prototype.outputIsNotNull=function(){return this.addOperation({what:"outputIsNotNull"})},Workflow.Task.prototype.outputNotNull=Workflow.Task.prototype.outputIsNotNull,Workflow.Task.prototype.inputSameAsOutput=function(){return this.addOperation({what:"inputSameAsOutput"})},Workflow.Task.prototype.outputIsArray=function(){return this.addOperation({what:"outputIsArray"})},Workflow.Task.prototype.outputArrayLengthIs=function(a,b){return this.addOperation({what:"outputArrayLengthIs",min:a,max:b})},Workflow.Task.prototype.outputIsArrayWithLength=function(a){return this.addOperation({what:"outputArrayLengthIs",min:a,max:a})},Workflow.Task.prototype.outputIsArrayWithMinLength=function(a){return this.addOperation({what:"outputArrayLengthIs",min:a})},Workflow.Task.prototype.outputIsArrayWithMaxLength=function(a){return this.addOperation({what:"outputArrayLengthIs",max:a})},Workflow.Task.prototype.outputArrayContains=function(a){return this.addOperation({what:"outputArrayContains",value:a})},Workflow.Task.prototype.arrayContains=function(a,b){return this.addOperation({what:"arrayContains",property:a,value:b})},Workflow.Task.prototype.arrayLengthIs=function(a,b,c){return this.addOperation({what:"arrayLengthIs",property:a,min:b,max:c})},Workflow.Task.prototype.arrayDoesntContain=function(a,b){return this.addOperation({what:"arrayDoesntContain",property:array,value:b})},Workflow.Task.prototype.propertyIsNull=function(a){return this.addOperation({what:"propertyIsNull",property:a})},Workflow.Task.prototype.propertyChanged=function(a){return this.addOperation({what:"propertyChanged",property:a})},Workflow.Task.prototype.outputPropertyChanged=Workflow.Task.prototype.propertyChanged,Workflow.Task.prototype.propertyContains=function(a,b){return this.addOperation({what:"propertyContains",property:a,value:b})},Workflow.Task.prototype.propertyDoesntContain=function(a,b){return this.addOperation({what:"propertyDoesntContain",property:a,value:b})},Workflow.Task.prototype.propertyIsNotNull=function(a){return this.addOperation({what:"propertyIsNotNull",property:a})},Workflow.Task.prototype.outputHasProperty=Workflow.Task.prototype.propertyIsNotNull,Workflow.Task.prototype.propertyIsArray=function(a){return this.addOperation({what:"propertyIsArray",property:a})},Workflow.Task.prototype.savePropertyAs=function(a,b){return this.addOperation({what:"savePropertyAs",property:a,name:b})},Workflow.Task.prototype.saveOutputAs=function(a){return this.addOperation({what:"saveOutputAs",name:a})},Workflow.Task.prototype.outputEval=function(a){return this.addOperation({what:"outputEval",eval:a.toString()})},Workflow.Task.prototype.headerContains=function(a,b){return this.addOperation({what:"headerContains",header:a,value:b})},Workflow.Task.prototype.hasStatusCode=function(a){return this.addOperation({what:"hasStatusCode",statusCode:a})},Workflow.Task.Wait=function(a){this.type="Wait",this.data="object"==typeof a&&"Wait"==a.type?a.data:{wait:a||1e3},Workflow.Task.call(this)},Workflow.Script.prototype.wait=function(a){var b=new Workflow.Task.Wait(a);return this.tasks.push(b),null},Workflow.Task.Wait.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Wait.constructor=Workflow.Task.Wait,Workflow.Task.Wait.prototype.toString=function(){return"Wait "+this.data.wait+"ms"},Workflow.Task.Wait.prototype.execute=function(a,b){var c=this;setTimeout(b,c.data.wait)},Workflow.Task.Until=function(a,b,c){this.type="Until",this.data="object"==typeof a&&"Until"===a.type?a.data:{until:a,delay:b||1e3,times:c},Workflow.Task.call(this)},Workflow.Task.Until.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Until.constructor=Workflow.Task.Until,Workflow.Task.Until.prototype.toString=function(){return"Until "+this.data.until+" every"+("number"==typeof this.data.delay?" "+this.data.delay+"ms":"")+("number"==typeof this.data.times?" "+this.data.times+" times":"")},Workflow.Task.Until.prototype.execute=function(a,b){var c=this;if(!a.do)throw new Error("'do' is not supported in this context");if(this.data.with){var d=JSON.parse(JSON.stringify(this.data.with));input=d&&this.resolveWith(a,d)}var e=this.data.times,f=function(){a._do(c.data.until,input,function(d,g,h){var i=c.runTests(a,input,d,g,h);return i.result?b(d,g,i):"number"==typeof e&&(e--,0>e)?b(d,g,i):(a.intermediateResult(c,d,g,i),void setTimeout(f,c.data.delay))})};f()},Workflow.Task.Do=function(a){this.type="Do",this.data="object"==typeof a&&"Do"===a.type?a.data:{"do":a},Workflow.Task.call(this)},Workflow.Task.Do.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Do.constructor=Workflow.Task.Do,Workflow.Task.Do.prototype.toString=function(){return"Do "+this.data.do+" with "+JSON.stringify(this.data.with)},Workflow.Task.Do.prototype.execute=function(a,b){var c,d=this;if(!a.do)throw new Error("'do' is not supported in this context");if(this.data.with){var e=JSON.parse(JSON.stringify(this.data.with));c=e&&this.resolveWith(a,e)}a._do(this.data.do,c,function(e,f,g){var h=d.runTests(a,c,e,f,g);return b(e,f,h)})},Workflow.Task.Times=function(a,b){this.type="Times","object"==typeof a&&"Times"==a.type?(this.data=a.data,this.data.script=new Workflow.Script(a.data.script)):(this.data={times:a},this.data.script=new Workflow.Script("Times:"+a),b(this.data.script)),Workflow.Task.call(this)},Workflow.Task.Times.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Times.constructor=Workflow.Task.Times,Workflow.Task.Times.prototype.toString=function(){return"Execute block "+this.data.times+" times"},Workflow.Task.Times.prototype.execute=function(a,b){var c=this,d=this.data.times,e=function(){d>0?a.run(c.data.script,function(b,f){a.intermediateResult(c,b,f),d--,e()}):b(null,null)};e()},Workflow.Task.ForEach=function(a,b,c,d){this.type="ForEach","object"==typeof a&&"ForEach"==a.type?(this.data=a.data,this.data.script=new Workflow.Script(a.data.script)):(this.data={},this.data.input=a,this.data.index=b,this.data.value=c,this.data.script=new Workflow.Script("ForEach:"+a),d(this.data.script)),Workflow.Task.call(this)},Workflow.Task.ForEach.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.ForEach.constructor=Workflow.Task.ForEach,Workflow.Task.ForEach.prototype.toString=function(){return"ForEach "+this.data.input+" as "+this.data.index+" -> "+this.data.value},Workflow.Task.ForEach.prototype.execute=function(a,b){var c=this,d=this.data.input&&this.resolveWith(a,[this.data.input]),e=0;if(d instanceof Array){e=0;var f=function(){return e<d.length?(a.saveValue(c.data.index,e),a.saveValue(c.data.value,d[e]),a.run(c.data.script,function(){e++,f()}),void 0):b(null,null)};f()}else{if("object"!=typeof d)throw new Error("Invalid iteration value:"+JSON.stringify(d));e=0;var g=Object.keys(d),h=function(){return e<g.length?(a.saveValue(c.data.index,g[e]),a.saveValue(c.data.value,d[g[e]]),a.run(c.data.script,function(){e++,h()}),void 0):b(null,null)};h()}},Workflow.Task.Use=function(a){this.type="Use","object"==typeof a&&"Use"==a.type?this.data=a.data:(this.data={},this.data.use=a),Workflow.Task.call(this)},Workflow.Task.Use.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Use.constructor=Workflow.Task.Use,Workflow.Task.Use.prototype.execute=function(a,b){if(!a.use)throw new Error("'use' is not supported in this context");var c=this.data.use;c=c.replace(/\#{[^}]+}/g,function(b){return Workflow.resolve(a,b)}),a.use(c,function(c,d){a.api||(a.api={});for(var e in d)a.api[e]=d[e];return b(c,d)})},Workflow.Task.Use.prototype.toString=function(){return"Use the API from "+this.data.use},Workflow.Task.AsyncWait=function(a){this.type="AsyncWait","object"==typeof a&&"AsyncWait"==a.type?this.data=a.data:(this.data={},this.data.asyncWait=a),Workflow.Task.call(this)},Workflow.Task.AsyncWait.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.AsyncWait.constructor=Workflow.Task.AsyncWait,Workflow.Task.AsyncWait.prototype.toString=function(){return"Async wait for group "+this.data.asyncWait},Workflow.Task.AsyncWait.prototype.execute=function(a,b){var c=this;if("undefined"!=typeof a.asyncGroups[c.data.asyncWait]){var d=function(){a.asyncGroups[c.data.asyncWait]>0?setTimeout(d,50):b()};d()}else b()},Workflow.Task.Get=function(a){this.type="Get","object"==typeof a&&"Get"===a.type?this.data=a.data:(this.data={},this.data.get=a),Workflow.Task.call(this)},Workflow.Task.Get.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Get.constructor=Workflow.Task.Get,Workflow.Task.Get.prototype.toString=function(){return"Get "+this.data.get},Workflow.Task.Get.prototype.execute=function(a,b){var c=this;if(!a.get)throw new Error("'get' is not supported in this context'");var d={};if(this.data.with){var e=JSON.parse(JSON.stringify(this.data.with));d=e&&this.resolveWith(a,e)}var f=this.data.get;f=f.replace(/\#{[^}]+}/g,function(b){return Workflow.resolve(a,b)}),a.get(f,function(e,f,g){var h=c.runTests(a,d,e,f,g);b(e,f,h)})},Workflow.Task.Post=function(a){this.type="Post","object"==typeof a&&"Post"===a.type?this.data=a.data:(this.data={},this.data.post=a),Workflow.Task.call(this)},Workflow.Task.Post.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Post.constructor=Workflow.Task.Post,Workflow.Task.Post.prototype.toString=function(){return"Post "+this.data.post},Workflow.Task.Post.prototype.execute=function(a,b){var c=this;if(!a.post)throw new Error("'post' is not supported in this context'");var d;if(this.data.with){var e=JSON.parse(JSON.stringify(this.data.with));d=e&&this.resolveWith(a,e)}var f=this.data.post;f=f.replace(/\#{[^}]+}/g,function(b){return Workflow.resolve(a,b)}),a.post(f,d,function(e,f,g){var h=c.runTests(a,d,e,f,g);b(e,f,h)})},Workflow.Task.Put=function(a){this.type="Put","object"==typeof a&&"Put"==a.type?this.data=a.data:(this.data={},this.data.put=a),Workflow.Task.call(this)},Workflow.Task.Put.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Put.constructor=Workflow.Task.Put,Workflow.Task.Put.prototype.toString=function(){return"Put "+this.data.put},Workflow.Task.Put.prototype.execute=function(a,b){var c=this;if(!a.put)throw new Error("'post' is not supported in this context'");var d;if(this.data.with){var e=JSON.parse(JSON.stringify(this.data.with));d=e&&this.resolveWith(a,e)}var f=this.data.put;f=f.replace(/\#{[^}]+}/g,function(b){return Workflow.resolve(a,b)}),a.put(f,d,function(e,f,g){var h=c.runTests(a,d,e,f,g);b(e,f,h)})},Workflow.Task.Delete=function(a){this.type="Delete","object"==typeof a&&"Delete"==a.type?this.data=a.data:(this.data={},this.data.delete=a),Workflow.Task.call(this)},Workflow.Task.Delete.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Delete.constructor=Workflow.Task.Delete,Workflow.Task.Delete.prototype.toString=function(){return"Delete "+this.data.delete},Workflow.Task.Delete.prototype.execute=function(a,b){var c=this;if(!a.delete)throw new Error("'post' is not supported in this context'");var d;if(this.data.with){var e=JSON.parse(JSON.stringify(this.data.with));d=e&&this.resolveWith(a,e)}var f=this.data.delete;f=f.replace(/\#{[^}]+}/g,function(b){return Workflow.resolve(a,b)}),a.delete(f,d,function(d,e,f){var g=c.runTests(a,input,d,e,f);b(d,e,g)})},Workflow.Context=function(){this.stack=[],this.values={},this.asyncGroups={},this.api={},this.depth=0},Workflow.Context.prototype.saveValue=function(a,b){return this.values[a]=b,b},Workflow.Context.prototype.loadValue=function(a){return"string"==typeof a&&"undefined"!=typeof this.values?Workflow.getProperty(this.values,a):void 0},Workflow.Context.prototype._onStartTask=function(a){this.tasks++,this.onStartTask(a)},Workflow.Context.prototype._do=function(a,b,c){this.onTaskInput(b),this.do(a,b,c)},Workflow.Context.prototype._onCompleteTask=function(a,b,c,d){var e=this;d&&d.results.forEach(function(a){a.result===!0?e.pass++:e.fail++}),this.onCompleteTask(a,b,c,d)},Workflow.Context.prototype.summarize=function(){return{tasks:this.tasks,fail:this.fail,pass:this.pass,duration:this.finishTime-this.startTime}},Workflow.Context.prototype.setStepper=function(a){this.stepper=a},Workflow.Context.prototype.run=function(a,b){var c=this;0===this.depth&&(this.startTime=Date.now(),this.tasks=0,this.pass=0,this.fail=0,a.validate(this));var d=a.tasks,e=0,f=this.stepper||function(a){a()};this.depth++;var g=function(){if(e<d.length)d[e].run(c,function(){e++,f(g)});else{c.depth--,c.finishTime=Date.now();var h=c.summarize();0===c.depth?(c.log("("+a.name+")","tasks:",h.tasks,"pass",h.pass,"fail",h.fail),b(null,c.summarize())):b()}};f(g)},Workflow.Context.prototype.get=function(){throw new Error("Not implemented")},Workflow.Context.prototype.post=function(){throw new Error("Not implemented")},Workflow.Context.prototype.put=function(){throw new Error("Not implemented")},Workflow.Context.prototype.delete=function(){throw new Error("Not implemented")},Workflow.Context.prototype.use=function(){throw new Error("Not implemented")},Workflow.Context.prototype.do=function(){throw new Error("Not implemented")},Workflow.Context.prototype.onStartTask=function(a){this.currentTask={task:a.toString()},this.logTaskStart(a.toString()),this.log("")},Workflow.Context.prototype.log=function(){for(var a=Array.prototype.slice.call(arguments),b="",c=0;c<this.depth;c++)b+="	";a.unshift(b),console.log.apply(console,a)},Workflow.Context.prototype.logTaskStart=Workflow.Context.prototype.log,Workflow.Context.prototype.logFail=Workflow.Context.prototype.log,Workflow.Context.prototype.logPass=Workflow.Context.prototype.log,Workflow.Context.prototype.onTaskInput=function(a){this.log("	Input:",JSON.stringify(a))},Workflow.Context.prototype.intermediateResult=function(a,b,c){("undefined"!=typeof b||"undefined"!=typeof c)&&this.log("	(Error:",b,"Result:",JSON.stringify(c),")")},Workflow.Context.prototype.onCompleteTask=function(a,b,c,d){var e=this;this.log("	Error",b),this.log("	Output",JSON.stringify(c)),this.log(""),d&&d.results.forEach(function(a){a.result?e.logPass("		","PASS",a.msg):e.logFail("		","FAIL",a.msg)}),this.log("")},"undefined"==typeof Workflow&&(Workflow={},assert=require("assert")),Workflow.msg=function(msg,options){with(options=options||{})return msg.replace(/#{([A-Za-z0-9\.\_]+)}/g,function(m,m1,m2){var r=eval(m1);return"object"==typeof r?JSON.stringify(r):r})},Workflow.pass=function(a,b){return{result:!0,msg:Workflow.msg(a,b)}},Workflow.fail=function(a,b){return{result:!1,msg:Workflow.msg(a,b)}},Workflow.utils={},Workflow.utils.objectCovers=function(a,b){var c,d=function(a,b){if(typeof a!=typeof b)return!1;if(a instanceof Array){for(var e in a){var f=!1;for(var g in b)d(a[e],b[g])&&(f=!0);if(!f)return!1}return!0}if("object"==typeof a){for(var h in a){if(null!==a&&null===b)return!1;if(typeof a[h]!=typeof b[h])return!1;if(a[h]instanceof Array){if(c=d(a[h],b[h]),c===!1)return!1}else if("object"==typeof a[h]){if(c=d(a[h],b[h]),c===!1)return!1}else if(a[h]!==b[h])return!1}return!0}return a===b};return d(a,b)},Workflow.utils.arrayContains=function(a,b){if(a instanceof Array)for(var c in a)if(Workflow.utils.objectCovers(b,a[c]))return!0;return!1},assert.equal(Workflow.utils.objectCovers([1,2,3,4],[1,2,3,4,5]),!0),assert.equal(Workflow.utils.objectCovers([1,2,3,4],[1,2,4,5]),!1),assert.equal(Workflow.utils.objectCovers("hello","hello"),!0),assert.equal(Workflow.utils.objectCovers({a:1},{a:1}),!0),assert.equal(Workflow.utils.objectCovers({a:1},{b:1}),!1),assert.equal(Workflow.utils.objectCovers({a:1,b:1},{a:1,b:1,c:3}),!0),assert.equal(Workflow.utils.objectCovers({a:1,b:{k:3}},{a:1,b:{k:3}}),!0),assert.equal(Workflow.utils.objectCovers({a:1,b:{k:3}},{a:1,b:{k:8}}),!1),assert.equal(Workflow.utils.objectCovers({a:1,b:{k:3},complex:[1,"3","A",{a:1},{b:5,c:[1,2,3,"5"]}]},{a:1,b:{k:3},complex:[1,"3","A",{a:1},{b:5,c:[1,2,3,"5"]}]}),!0),assert.equal(Workflow.utils.objectCovers({a:1,b:{k:3},complex:[1,"3","A",{a:1},{b:5,c:[1,2,3,"5"]}]},{a:1,b:{k:3}}),!1),assert.equal(Workflow.utils.objectCovers({a:1,b:{k:3},complex:[1,"3","A",{a:1},{b:5,c:[1,2,3,"5"]}]},{a:1,b:{k:3},complex:[1,"3","A",{a:1},{b:5,c:[1,2,3]}]}),!1),assert.equal(Workflow.utils.objectCovers([{name:"foo"},{name:"bar",roles:["a","b","c"],thing:{a:1,b:2}}],[{name:"foo"},{name:"bar",roles:["a","b","c"],thing:{a:1,b:2}}]),!0),assert.equal(Workflow.utils.objectCovers([{name:"foo"},{name:"bar",roles:["a","b","c"],thing:{a:1,b:2}}],[{name:"foo"},{name:"bar",roles:["a","b","c"],thing:{a:1,b:5}}]),!1),assert.equal(Workflow.utils.objectCovers([{name:"foo"},{name:"bar",roles:["a","b","c"],thing:{a:1,b:2}}],[{name:"bar",roles:["a","b","c"],thing:{a:1,b:5}}]),!1),Workflow.Tests={},Workflow.Tests.errorContains=function(a,b,c,d,e){return e&&(d=JSON.parse(JSON.stringify(d)),d.value=Workflow.resolve(e,d.value,!0),console.log("RESOLVED ERROR TO",d.value)),null!==c?"string"==typeof c&&-1!=c.indexOf(d.value)?Workflow.pass("The error contained '#{value}'",d):Workflow.utils.objectCovers(d.value,c)?Workflow.pass("The error contained '#{value}'",d):Workflow.fail("The error did not contain '#{value}'",d):Workflow.fail("There was no error")},assert.deepEqual(Workflow.Tests.errorContains(null,null,null,{value:"ERROR"}),{result:!1,msg:"There was no error"}),assert.deepEqual(Workflow.Tests.errorContains(null,null,"ERROR",{value:"ERROR"}),{result:!0,msg:"The error contained 'ERROR'"}),assert.deepEqual(Workflow.Tests.errorContains(null,null,{what:"ERROR"},{value:{what:"ERROR"}}),{result:!0,msg:'The error contained \'{"what":"ERROR"}\''}),assert.deepEqual(Workflow.Tests.errorContains(null,null,"ERR",{value:"ERROR"}),{result:!1,msg:"The error did not contain 'ERROR'"}),Workflow.Tests.errorIsNull=function(a,b,c){return null===c?Workflow.pass("The error was null"):Workflow.fail("The error was not null")},assert.deepEqual(Workflow.Tests.errorIsNull(null,null,null),{result:!0,msg:"The error was null"}),assert.deepEqual(Workflow.Tests.errorIsNull(null,null,!0),{result:!1,msg:"The error was not null"}),Workflow.Tests.errorIsNotNull=function(a,b,c){return null===c?Workflow.fail("The error was null"):Workflow.pass("The error was not null")},assert.deepEqual(Workflow.Tests.errorIsNotNull(null,null,null),{result:!1,msg:"The error was null"}),assert.deepEqual(Workflow.Tests.errorIsNotNull(null,null,!0),{result:!0,msg:"The error was not null"}),Workflow.Tests.outputIsNull=function(a,b){return null===b?Workflow.pass("The output was null"):Workflow.fail("The output was not null")},assert.deepEqual(Workflow.Tests.outputIsNull(null,null),{result:!0,msg:"The output was null"}),assert.deepEqual(Workflow.Tests.outputIsNull(null,!0),{result:!1,msg:"The output was not null"}),Workflow.Tests.outputIsNotNull=function(a,b){return null===b?Workflow.fail("The output was null"):Workflow.pass("The output was not null")},assert.deepEqual(Workflow.Tests.outputIsNotNull(null,null),{result:!1,msg:"The output was null"}),assert.deepEqual(Workflow.Tests.outputIsNotNull(null,!0),{result:!0,msg:"The output was not null"}),Workflow.Tests.outputArrayContains=function(a,b,c,d,e){if(c)return Workflow.fail("There was an error");if(!(b instanceof Array))return Workflow.fail("The output was not an array");e&&(d=JSON.parse(JSON.stringify(d)),d.value=Workflow.resolve(e,d.value,!0));for(var f in b)if(Workflow.utils.objectCovers(d.value,b[f]))return Workflow.pass("The output array contained '#{value}'",d);return Workflow.fail("The output array did not contain '#{value}'",d)},assert.deepEqual(Workflow.Tests.outputArrayContains(null,null,null,{value:null}),{result:!1,msg:"The output was not an array"}),assert.deepEqual(Workflow.Tests.outputArrayContains(null,["hello"],null,{value:null}),{result:!1,msg:"The output array did not contain 'null'"}),assert.deepEqual(Workflow.Tests.outputArrayContains(null,["wolf"],null,{value:"wolf"}),{result:!0,msg:"The output array contained 'wolf'"}),assert.deepEqual(Workflow.Tests.outputArrayContains(null,[{a:1,b:2}],null,{value:{a:1}}),{result:!0,msg:"The output array contained '{\"a\":1}'"}),Workflow.Tests.outputContains=function(a,b,c,d,e){return c?Workflow.fail("There was an error"):(e&&(d=JSON.parse(JSON.stringify(d)),d.value=Workflow.resolve(e,d.value,!0)),Workflow.utils.objectCovers(d.value,b)?Workflow.pass("The output contained '#{value}'",d):Workflow.fail("The output did not contain '#{value}'",d))},assert.deepEqual(Workflow.Tests.outputContains(null,null,null,{value:null}),{result:!0,msg:"The output contained 'null'"}),assert.deepEqual(Workflow.Tests.outputContains(null,"hello",null,{value:null}),{result:!1,msg:"The output did not contain 'null'"}),assert.deepEqual(Workflow.Tests.outputContains(null,"wolf",null,{value:"wolf"}),{result:!0,msg:"The output contained 'wolf'"}),assert.deepEqual(Workflow.Tests.outputContains(null,{a:1,b:2},null,{value:{a:1}}),{result:!0,msg:"The output contained '{\"a\":1}'"}),Workflow.Tests.outputDoesNotContain=function(a,b,c,d,e){return e&&(d=JSON.parse(JSON.stringify(d)),d.value=Workflow.resolve(e,d.value,!0)),Workflow.utils.objectCovers(d.value,b)?Workflow.fail("The output contained '#{value}'",d):Workflow.pass("The output did not contain '#{value}'",d)},assert.deepEqual(Workflow.Tests.outputDoesNotContain(null,null,null,{value:null}),{result:!1,msg:"The output contained 'null'"}),assert.deepEqual(Workflow.Tests.outputDoesNotContain(null,"hello",null,{value:null}),{result:!0,msg:"The output did not contain 'null'"}),assert.deepEqual(Workflow.Tests.outputDoesNotContain(null,"wolf",null,{value:"wolf"}),{result:!1,msg:"The output contained 'wolf'"}),assert.deepEqual(Workflow.Tests.outputDoesNotContain(null,{a:1,b:2},null,{value:{a:1}}),{result:!1,msg:"The output contained '{\"a\":1}'"}),Workflow.Tests.outputArrayLengthIs=function(a,b,c,d,e){if(e&&(d=JSON.parse(JSON.stringify(d)),d.min=Workflow.resolve(e,d.min,!0),d.max=Workflow.resolve(e,d.max,!0)),null===b)return Workflow.fail("The output was null");var f=b;if(f instanceof Array){if("undefined"!=typeof d.min&&f.length<d.min)return Workflow.fail("The output array length was < #{min}",d);if("undefined"!=typeof d.max&&f.length>d.max)return Workflow.fail("The output array length was > #{max}",d);
if("undefined"!=typeof d.min&&"undefined"!=typeof d.max)return Workflow.pass("The output array length was between #{min} and #{max}",d);if("undefined"!=typeof d.min)return Workflow.pass("The output array length was > #{min}",d);if("undefined"!=typeof d.max)return Workflow.pass("The output array length was < #{max}",d)}return Workflow.fail("The output is not an array",d)},assert.deepEqual(Workflow.Tests.outputArrayLengthIs(null,null,null,{property:"foo",value:1}),{result:!1,msg:"The output was null"}),assert.deepEqual(Workflow.Tests.outputArrayLengthIs(null,[1,2,3,4,5],null,{property:"foo",min:1}),{result:!0,msg:"The output array length was > 1"}),assert.deepEqual(Workflow.Tests.outputArrayLengthIs(null,[1,2,3,4,5],null,{property:"foo",min:10}),{result:!1,msg:"The output array length was < 10"}),assert.deepEqual(Workflow.Tests.outputArrayLengthIs(null,[1,2,3,4,5],null,{property:"foo",max:1}),{result:!1,msg:"The output array length was > 1"}),assert.deepEqual(Workflow.Tests.outputArrayLengthIs(null,[1,2,3,4,5],null,{property:"foo",max:10}),{result:!0,msg:"The output array length was < 10"}),assert.deepEqual(Workflow.Tests.outputArrayLengthIs(null,[1,2,3,4,5],null,{property:"foo",min:1,max:10}),{result:!0,msg:"The output array length was between 1 and 10"}),Workflow.Tests.outputIsArray=function(a,b){return b instanceof Array?Workflow.pass("The output was an array"):Workflow.fail("The output was not an array")},assert.deepEqual(Workflow.Tests.outputIsArray(null,[],null,null),{result:!0,msg:"The output was an array"}),assert.deepEqual(Workflow.Tests.outputIsArray(null,null,null,null),{result:!1,msg:"The output was not an array"}),Workflow.Tests.arrayContains=function(a,b,c,d,e){if(e&&(d=JSON.parse(JSON.stringify(d)),d.value=Workflow.resolve(e,d.value,!0)),null!==b){var f=Workflow.getProperty(b,d.property);return f instanceof Array?Workflow.utils.arrayContains(f,d.value)?Workflow.pass("The array property '#{property}' contained '#{value}'",d):Workflow.fail("The array property '#{property}' did not contain '#{value}'",d):Workflow.fail("The array property '#{property}' was not an array",d)}return Workflow.fail("The output was null")},assert.deepEqual(Workflow.Tests.arrayContains(null,null,null,{property:"foo",value:1}),{result:!1,msg:"The output was null"}),assert.deepEqual(Workflow.Tests.arrayContains(null,{foo:null},null,{property:"foo",value:1}),{result:!1,msg:"The array property 'foo' was not an array"}),assert.deepEqual(Workflow.Tests.arrayContains(null,{foo:[1]},null,{property:"foo",value:1}),{result:!0,msg:"The array property 'foo' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayContains(null,{foo:[3,4,6,"s",null,1]},null,{property:"foo",value:1}),{result:!0,msg:"The array property 'foo' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayContains(null,{foo:{bar:[3,4,6,"s",null,1]}},null,{property:"foo.bar",value:1}),{result:!0,msg:"The array property 'foo.bar' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayContains(null,{foo:[2]},null,{property:"foo",value:1}),{result:!1,msg:"The array property 'foo' did not contain '1'"}),Workflow.Tests.arrayLengthIs=function(a,b,c,d,e){if(e&&(d=JSON.parse(JSON.stringify(d)),d.min=Workflow.resolve(e,d.min,!0),d.max=Workflow.resolve(e,d.max,!0)),null===b)return Workflow.fail("The output was null");var f=Workflow.getProperty(b,d.property);if(f instanceof Array){if("undefined"!=typeof d.min&&f.length<d.min)return Workflow.fail("The array '#{property}' length was < #{min}",d);if("undefined"!=typeof d.max&&f.length>d.max)return Workflow.fail("The array '#{property}' length was > #{max}",d);if("undefined"!=typeof d.min&&"undefined"!=typeof d.max)return Workflow.pass("The array '#{property}' length was between #{min} and #{max}",d);if("undefined"!=typeof d.min)return Workflow.pass("The array '#{property}' length was > #{min}",d);if("undefined"!=typeof d.max)return Workflow.pass("The array '#{property}' length was < #{max}",d)}return Workflow.fail("The property #{property} is not an array",d)},assert.deepEqual(Workflow.Tests.arrayLengthIs(null,null,null,{property:"foo",value:1}),{result:!1,msg:"The output was null"}),assert.deepEqual(Workflow.Tests.arrayLengthIs(null,{foo:[1,2,3,4,5]},null,{property:"foo",min:1}),{result:!0,msg:"The array 'foo' length was > 1"}),assert.deepEqual(Workflow.Tests.arrayLengthIs(null,{foo:[1,2,3,4,5]},null,{property:"foo",min:10}),{result:!1,msg:"The array 'foo' length was < 10"}),assert.deepEqual(Workflow.Tests.arrayLengthIs(null,{foo:[1,2,3,4,5]},null,{property:"foo",max:1}),{result:!1,msg:"The array 'foo' length was > 1"}),assert.deepEqual(Workflow.Tests.arrayLengthIs(null,{foo:[1,2,3,4,5]},null,{property:"foo",max:10}),{result:!0,msg:"The array 'foo' length was < 10"}),assert.deepEqual(Workflow.Tests.arrayLengthIs(null,{foo:[1,2,3,4,5]},null,{property:"foo",min:1,max:10}),{result:!0,msg:"The array 'foo' length was between 1 and 10"}),Workflow.Tests.arrayDoesntContain=function(a,b,c,d,e){if(e&&(d=JSON.parse(JSON.stringify(d)),d.value=Workflow.resolve(e,d.value,!0)),null!==b){var f=Workflow.getProperty(b,d.property);return f instanceof Array?Workflow.utils.arrayContains(f,d.value)?Workflow.fail("The array property '#{property}' contained '#{value}'",d):Workflow.pass("The array property '#{property}' did not contain '#{value}'",d):Workflow.fail("The array property '#{property}' was not an array",d)}return Workflow.fail("The output was null")},assert.deepEqual(Workflow.Tests.arrayDoesntContain(null,null,null,{property:"foo",value:1}),{result:!1,msg:"The output was null"}),assert.deepEqual(Workflow.Tests.arrayDoesntContain(null,{foo:null},null,{property:"foo",value:1}),{result:!1,msg:"The array property 'foo' was not an array"}),assert.deepEqual(Workflow.Tests.arrayDoesntContain(null,{foo:[1]},null,{property:"foo",value:1}),{result:!1,msg:"The array property 'foo' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayDoesntContain(null,{foo:[3,4,6,"s",null,1]},null,{property:"foo",value:1}),{result:!1,msg:"The array property 'foo' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayDoesntContain(null,{foo:{bar:[3,4,6,"s",null,1]}},null,{property:"foo.bar",value:1}),{result:!1,msg:"The array property 'foo.bar' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayDoesntContain(null,{foo:[2]},null,{property:"foo",value:1}),{result:!0,msg:"The array property 'foo' did not contain '1'"}),Workflow.Tests.propertyIsNull=function(a,b,c,d){if(b){var e=Workflow.getProperty(b,d.property);return null===e?Workflow.pass("The property '#{property}' was null",d):Workflow.fail("The property '#{property}' was not null",d)}return Workflow.fail("The output was null",d)},assert.deepEqual(Workflow.Tests.propertyIsNull(null,{foo:"hello"},null,{property:"foo"}),{result:!1,msg:"The property 'foo' was not null"}),assert.deepEqual(Workflow.Tests.propertyIsNull(null,{foo:null},null,{property:"foo"}),{result:!0,msg:"The property 'foo' was null"}),assert.deepEqual(Workflow.Tests.propertyIsNull(null,null,null,{property:"foo"}),{result:!1,msg:"The output was null"}),Workflow.Tests.propertyIsNotNull=function(a,b,c,d){if(b){var e=Workflow.getProperty(b,d.property);return null!==e?Workflow.pass("The property '#{property}' was not null",d):Workflow.fail("The property '#{property}' was null",d)}return Workflow.fail("The output was null",d)},assert.deepEqual(Workflow.Tests.propertyIsNotNull(null,{foo:"hello"},null,{property:"foo"}),{result:!0,msg:"The property 'foo' was not null"}),assert.deepEqual(Workflow.Tests.propertyIsNotNull(null,{foo:null},null,{property:"foo"}),{result:!1,msg:"The property 'foo' was null"}),assert.deepEqual(Workflow.Tests.propertyIsNotNull(null,null,null,{property:"foo"}),{result:!1,msg:"The output was null"}),Workflow.Tests.propertyChanged=function(a,b,c,d){if(b){if(!a)return Workflow.fail("The input was null");var e=Workflow.getProperty(b,d.property),f=Workflow.getProperty(a,d.property);return f!=e?Workflow.pass("The value changed from '#{inputValue}' to '#{outputValue}'",{inputValue:f,outputValue:e}):Workflow.fail("The value did not change")}return Workflow.fail("The output was null",d)},assert.deepEqual(Workflow.Tests.propertyChanged({foo:"hello"},{foo:"hello"},null,{property:"foo"}),{result:!1,msg:"The value did not change"}),assert.deepEqual(Workflow.Tests.propertyChanged({foo:"hello"},{foo:"bye"},null,{property:"foo"}),{result:!0,msg:"The value changed from 'hello' to 'bye'"}),Workflow.Tests.propertyContains=function(a,b,c,d,e){if(b){e&&(d=JSON.parse(JSON.stringify(d)),d.value=Workflow.resolve(e,d.value,!0));var f=Workflow.getProperty(b,d.property);return Workflow.utils.objectCovers(d.value,f)?Workflow.pass("The property '#{property}' contained '#{value}'",d):Workflow.fail("The property '#{property}' did not contain '#{value}'",d)}return Workflow.fail("The output was null",d)},assert.deepEqual(Workflow.Tests.propertyContains(null,{foo:"hello"},null,{property:"foo",value:"hello"}),{result:!0,msg:"The property 'foo' contained 'hello'"}),assert.deepEqual(Workflow.Tests.propertyContains(null,{foo:"hello"},null,{property:"foo",value:"goodbye"}),{result:!1,msg:"The property 'foo' did not contain 'goodbye'"}),assert.deepEqual(Workflow.Tests.propertyContains(null,null,null,{property:"foo"}),{result:!1,msg:"The output was null"}),Workflow.Tests.propertyDoesntContain=function(a,b,c,d,e){if(b){e&&(d=JSON.parse(JSON.stringify(d)),d.value=Workflow.resolve(e,d.value,!0));var f=Workflow.getProperty(b,d.property);return Workflow.utils.objectCovers(d.value,f)?Workflow.pass("The property '#{property}' did not contain '#{value}'",d):Workflow.fail("The property '#{property}' contained '#{value}'",d)}return Workflow.fail("The output was null",d)},assert.deepEqual(Workflow.Tests.propertyDoesntContain(null,{foo:"hello"},null,{property:"foo",value:"hello"}),{result:!0,msg:"The property 'foo' did not contain 'hello'"}),assert.deepEqual(Workflow.Tests.propertyDoesntContain(null,{foo:"hello"},null,{property:"foo",value:"goodbye"}),{result:!1,msg:"The property 'foo' contained 'goodbye'"}),assert.deepEqual(Workflow.Tests.propertyDoesntContain(null,null,null,{property:"foo"}),{result:!1,msg:"The output was null"}),Workflow.Tests.propertyIsArray=function(a,b,c,d){if(b){var e=Workflow.getProperty(b,d.property);return e instanceof Array?Workflow.pass("The property '#{property}' was an array",d):Workflow.fail("The property '#{property}' was not an array",d)}return Workflow.fail("The output was null",d)},assert.deepEqual(Workflow.Tests.propertyIsArray(null,{foo:["hello"]},null,{property:"foo"}),{result:!0,msg:"The property 'foo' was an array"}),assert.deepEqual(Workflow.Tests.propertyIsArray(null,{foo:"hello"},null,{property:"foo"}),{result:!1,msg:"The property 'foo' was not an array"}),assert.deepEqual(Workflow.Tests.propertyIsArray(null,null,null,{property:"foo"}),{result:!1,msg:"The output was null"}),Workflow.Tests.saveOutputAs=function(a,b,c,d,e){return c?Workflow.fail("The value was not saved, because an error occured"):(e.saveValue(d.name,b),Workflow.pass("The result was saved as '#{name}'",d))},Workflow.Tests.savePropertyAs=function(a,b,c,d,e){if(!c){var f=Workflow.getProperty(b,d.property);return e.saveValue(d.name,f),Workflow.pass("The property '#{property}' was saved as '#{name}'",d)}return Workflow.fail("The value was not saved, because an error occured")},Workflow.Tests.outputEval=function(a,b,c,d,e){if(!c){"function"==typeof d.eval&&(d.eval=d.eval.toString()),d=JSON.parse(JSON.stringify(d)),d.eval=new Function("return ("+d.eval+")");var f=d.eval()(c,b,e);return f===!0?Workflow.pass("The evaluation function returned true"):Workflow.fail("The evaluation function did not return true, it returned '#{result}'",{result:f})}return Workflow.fail("The output was null")},assert.deepEqual(Workflow.Tests.outputEval(null,null,null,{eval:"function(){ return true; }"}),{result:!0,msg:"The evaluation function returned true"}),assert.deepEqual(Workflow.Tests.outputEval(null,null,null,{eval:"function(){ return false; }"}),{result:!1,msg:"The evaluation function did not return true, it returned 'false'"}),Workflow.Tests.headerContains=function(a,b,c,d,e,f){if(f){var g;if(f.getResponseHeader)g=f.getResponseHeader(d.header);else if(f.getHeader)g=f.getHeader(d.header);else if(f.get)g=f.get(d.header);else{if(!f.headers)return Workflow.fail("Unable to retrieve HTTP headers");g=f.headers[d.header]||f.headers[d.header.toLowerCase()]}return g?-1!=g.indexOf(d.value)?Workflow.pass("The header '#{header}' contained '#{value}'",d):Workflow.fail("The header '#{header}' did not contain '#{value}'",d):Workflow.fail("There was no header '#{header}' in the response",d)}return Workflow.fail("No HTTP headers were available")},Workflow.Tests.hasStatusCode=function(a,b,c,d,e,f){if(f){var g;if("undefined"!=typeof f.status)g=f.status;else{if("undefined"==typeof f.statusCode)return Workflow.fail("Unable to retrieve status code");g=f.statusCode}return g==d.statusCode?Workflow.pass("The response had a status of #{statusCode}",d):Workflow.fail("The response did not have a status code of #{statusCode}",d)}return Workflow.fail("No HTTP status code was available")},Workflow.Tests.inputSameAsOutput=function(a,b,c){return c?Workflow.fail("There was an error"):null===a&&b!==a?Workflow.fail("The input was null, and the output was not"):Workflow.utils.objectCovers(a,b)?Workflow.pass("The output contains the input"):Workflow.fail("The output does not contain the input")},assert.deepEqual(Workflow.Tests.inputSameAsOutput({foo:7},{foo:7}),{result:!0,msg:"The output contains the input"}),assert.deepEqual(Workflow.Tests.inputSameAsOutput({foo:7},{foo:8}),{result:!1,msg:"The output does not contain the input"}),assert.deepEqual(Workflow.Tests.inputSameAsOutput({foo:7},null),{result:!1,msg:"The output does not contain the input"}),assert.deepEqual(Workflow.Tests.inputSameAsOutput(null,{foo:7}),{result:!1,msg:"The input was null, and the output was not"}),assert.deepEqual(Workflow.Tests.inputSameAsOutput(null,null),{result:!0,msg:"The output contains the input"}),Workflow.Context.prototype.use=function(a,b){/\.js$/.test(a)||(a+="api/api.js"),$.getScript(a,function(a,c,d){return 200==d.status?b(null,!0):b(c)})},Workflow.Context.blobFromURL=function(a,b){var c=new XMLHttpRequest;c.open("get",a),c.responseType="blob",c.onload=function(){return this.response instanceof Blob?b(null,this.response):b(null,new Blob([this.response]))},c.send()},Workflow.Context.prototype.do=function(method,inputValue,onComplete){console.log("DOING IT",method,inputValue);var xhrTasks=[];for(var i in inputValue){var input=inputValue[i];null!==input&&"undefined"!=typeof input._fileFromURL&&(console.log("ADING XHR TASK",input),xhrTasks.push({url:input._fileFromURL,field:i}))}var times=1,run=function(){if(xhrTasks.length>0){var xhrTask=xhrTasks.shift();Workflow.Context.blobFromURL(xhrTask.url,function(a,b){inputValue[xhrTask.field]=b,console.log("Got blob from",xhrTask.url,xhrTask.field),run()})}else{console.log(inputValue);try{eval(method)(inputValue,onComplete)}catch(e){return onComplete("undefined"==typeof eval(method)?"Invalid method call:"+method:e)}}};run()},Workflow.Context.prototype.get=function(a,b){$.ajax({url:a,type:"GET"}).done(function(a,c,d){return a&&d.status>=200&&d.status<300?b(null,a,d):b(d.responseText,null,d)}).fail(function(a){return b(a.responseText,null,a)})},Workflow.Context.prototype.post=function(a,b,c){$.ajax({url:a,type:"POST",dataType:"json",data:JSON.stringify(b),contentType:"application/json"}).done(function(a,b,d){return a&&d.status>=200&&d.status<300?c(null,a,d):c(d.responseText,null,d)}).fail(function(a){return c(a.responseText,null,a)})},Workflow.Context.prototype.put=function(a,b,c){$.ajax({url:a,type:"PUT",dataType:"json",data:JSON.stringify(b),contentType:"application/json"}).done(function(a,b,d){return a&&d.status>=200&&d.status<300?c(null,a,d):c(d.responseText,null,d)}).fail(function(a){return c(a.responseText,null,a)})},Workflow.Context.prototype.delete=function(a,b,c){$.ajax({url:a,type:"DELETE"}).done(function(a,b,d){return a&&d.status>=200&&d.status<300?c(null,a,d):c(d.responseText,null,d)}).fail(function(a){return c(a.responseText,null,a)})},Workflow.Context.prototype.setSelector=function(a){this.selector=a},Workflow.Context.prototype.log=function(){var a=Array.prototype.slice.call(arguments);a=a.map(function(a){return"string"==typeof a?a:JSON.stringify(a)});for(var b="",c=0;c<this.depth;c++)b+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";str=b+a.join(" "),str=str.replace("	","&nbsp;&nbsp;&nbsp;"),str+="</br>",$(this.selector||"body").append(str)},Workflow.Context.prototype.logTaskStart=function(){var a=Array.prototype.slice.call(arguments);a=a.map(function(a){return"string"==typeof a?"<b>"+a+"</b>":a}),Workflow.Context.prototype.log.apply(this,a)},Workflow.Context.prototype.logFail=function(){var a=Array.prototype.slice.call(arguments);a=a.map(function(a){return"string"==typeof a?"<font color='red'>"+a+"</font>":a}),Workflow.Context.prototype.log.apply(this,a)},Workflow.Context.prototype.logPass=function(){var a=Array.prototype.slice.call(arguments);a=a.map(function(a){return"string"==typeof a?"<font color='green'>"+a+"</font>":a}),Workflow.Context.prototype.log.apply(this,a)};