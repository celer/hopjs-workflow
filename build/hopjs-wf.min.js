assert={equal:function(a,b){if(a!=b)throw new Error("Values did not match: "+JSON.stringify(a)+" "+JSON.stringify(b))},deepEqual:function(a,b){if(JSON.stringify(a)!=JSON.stringify(b))throw new Error("Values did not match: "+JSON.stringify(a)+" "+JSON.stringify(b))}},Workflow={},Workflow.extendTo=function(a,b){if(void 0===a)return b;var c=JSON.parse(JSON.stringify(a)),d=function(a,b){for(var c in b){var e=b[c];null!==e&&"object"==typeof e&&"object"==typeof a[c]?d(a[c],b[c]):a[c]=e}};return d(c,b),c},Workflow.resolve=function(a,b,c){if("string"==typeof b&&c===!0){var d=a.loadValue(b);if("undefined"!=typeof d)return d}if(b instanceof Array)return b.map(function(b){return Workflow.resolve(a,b)});if("object"==typeof b){for(var e in b){var f=b[e];b[e]=Workflow.resolve(a,f)}return b}if("string"==typeof b){var g=/^\#\{(.+)\}$/.exec(b);return g&&g.length>1?a.loadValue(g[1]):b}return b},Workflow.with=function(a,b){var c=b[0];if(!c instanceof Array)throw new Error("args must be an array");"string"==typeof c&&(c=a.loadValue(c));for(var d=1;d<b.length;d++)"string"==typeof c&&(c=a.loadValue(c)),"string"==typeof b[d]&&(b[d]=a.loadValue(b[d])),c=Workflow.extendTo(c,b[d]);return c=Workflow.resolve(a,c,!0)},"undefined"!=typeof module&&module.exports&&(module.exports=Workflow),Workflow.Script=function(a){if("string"==typeof a)this.name=a,this.tasks=[];else if("object"==typeof a){this.name=a.name;var b=["tasks","setup","tearDown"],c=this;b.forEach(function(b){a[b]&&a[b]instanceof Array&&(c[b]=a[b].map(function(a){return new Workflow.Task(a)}))})}},Workflow.Script.prototype.validate=function(a){var b;for(b in this.defaults)"undefined"==typeof a.loadValue(b)&&a.saveValue(b,this.defaults[b]);if(this.demand)for(b in this.demand)if("undefined"==typeof a.loadValue(b))throw new Error("Missing required value for script: "+b)},Workflow.Script.prototype.default=function(a,b){this.defaults||(this.defaults={}),this.defaults[a]=b},Workflow.Script.prototype.demand=function(a,b){this.demands||(this.demands={}),this.demands[a]={desc:b}},Workflow.Script.prototype.asyncWait=function(a){var b=new Workflow.Task.AsyncWait(a);return this.tasks.push(b),b},Workflow.Script.prototype.times=function(a,b){var c=new Workflow.Task.Times(a,b);return this.tasks.push(c),c},Workflow.Script.prototype.forEach=function(a,b,c,d){var e=new Workflow.Task.ForEach(a,b,c,d);return this.tasks.push(e),e},Workflow.Script.prototype.do=function(a){var b=new Workflow.Task.Do(a);return this.tasks.push(b),b},Workflow.Script.prototype.until=function(a,b,c){var d=new Workflow.Task.Until(a,b,c);return this.tasks.push(d),d},Workflow.Script.prototype.use=function(a){var b=new Workflow.Task.Use(a);return this.tasks.push(b),b},Workflow.Script.prototype.get=function(a){var b=new Workflow.Task.Get(a);return this.tasks.push(b),b},Workflow.Script.prototype.post=function(a){var b=new Workflow.Task.Post(a);return this.tasks.push(b),b},Workflow.Script.prototype.put=function(a){var b=new Workflow.Task.Put(a);return this.tasks.push(b),b},Workflow.Script.prototype.delete=function(a){var b=new Workflow.Task.Delete(a);return this.tasks.push(b),b},Workflow.Script.prototype.describe=function(a){this.description=a},Workflow.Task=function(){return this.data={},this},Workflow.Task.prototype.async=function(a){return this.data.asyncGroup=a,this},Workflow.Task.prototype.run=function(a,b){a._onStartTask(this);var c=this,d=function(b,d,e,f){a._onCompleteTask(c,b,d,e);var g=0;if((e&&e.result===!0||!e&&d)&&c.data.onSuccess)g++,a.run(c.data.onSuccess,function(){return g--,0===g?f(b,d,e):void 0});else if((e&&e.result===!1||!e&&b)&&c.data.onError)g++,a.run(c.data.onError,function(){return g--,0===g?f(b,d,e):void 0});else if(0===g)return f(b,d,e)};"string"==typeof c.data.asyncGroup?(a.asyncGroups[c.data.asyncGroup]||(a.asyncGroups[c.data.asyncGroup]=0),a.asyncGroups[c.data.asyncGroup]++,c.execute(a,function(b,e,f){d(b,e,f,function(){a.asyncGroups[c.data.asyncGroup]--})}),b(null,null,null)):c.execute(a,function(a,c,e){d(a,c,e,b)})},Workflow.Task.prototype.execute=function(){throw new Error("Execute for this task is not implemented")},Workflow.Task.prototype.runTests=function(a,b,c){var d=[],e=!0;if(this.data.tests)for(var f in this.data.tests){var g=this.data.tests[f];if(!Workflow.Tests[g.what])throw new Error("Invalid test specified '"+g.what+"'");var h=Workflow.Tests[g.what](c,b,g,a);h.test=g,d.push(h),h.result===!1&&(e=!1)}return{result:e,results:d}},Workflow.Task.prototype.with=function(){return this.data.with=Array.prototype.slice.call(arguments),this},Workflow.Task.prototype.onComplete=function(a){var b=new Workflow.Script("onComplete");return a(b),this.data.onComplete=b,this},Workflow.Task.prototype.onSuccess=function(a){var b=new Workflow.Script("onSuccess");return a(b),this.data.onSuccess=b,this},Workflow.Task.prototype.onError=function(a){var b=new Workflow.Script("onError");return a(b),this.data.onError=b,this},Workflow.Task.prototype.describe=function(a){return this.data.description=a,this},Workflow.Task.prototype.addOperation=function(a){return this.data.tests||(this.data.tests=[]),this.data.tests.push(a),this},Workflow.Task.prototype.errorContains=function(a){return this.addOperation({value:a,what:"errorContains"})},Workflow.Task.prototype.errorIsNull=function(){return this.addOperation({what:"errorIsNull"})},Workflow.Task.prototype.outputIsNull=function(){return this.addOperation({what:"outputIsNull"})},Workflow.Task.prototype.outputContains=function(a){return this.addOperation({what:"outputContains",value:a})},Workflow.Task.prototype.outputDoesntContain=function(a){return this.addOperation({what:"outputDoesntContain",value:a})},Workflow.Task.prototype.outputIsNotNull=function(){return this.addOperation({what:"outputIsNotNull"})},Workflow.Task.prototype.outputIsArray=function(){return this.addOperation({what:"outputIsArray"})},Workflow.Task.prototype.arrayContains=function(a,b){return this.addOperation({what:"arrayContains",property:a,value:b})},Workflow.Task.prototype.arrayLengthIs=function(a,b,c){return this.addOperation({what:"arrayLengthIs",property:a,min:b,max:c})},Workflow.Task.prototype.arrayDoesntContain=function(a,b){return this.addOperation({what:"arrayDoesntContain",property:array,value:b})},Workflow.Task.prototype.propertyIsNull=function(a){return this.addOperation({what:"propertyIsNull",property:a})},Workflow.Task.prototype.propertyContains=function(a,b){return this.addOperation({what:"propertyContains",property:a,value:b})},Workflow.Task.prototype.propertyDoesntContain=function(a,b){return this.addOperation({what:"propertyDoesntContain",property:a,value:b})},Workflow.Task.prototype.propertyIsNotNull=function(a){return this.addOperation({what:"propertyIsNotNull",property:a})},Workflow.Task.prototype.propertyIsArray=function(a){return this.addOperation({what:"propertyIsArray",property:a})},Workflow.Task.prototype.savePropertyAs=function(a,b){return this.addOperation({what:"savePropertyAs",property:a,name:b})},Workflow.Task.prototype.saveOutputAs=function(a){return this.addOperation({what:"saveOutputAs",name:a})},Workflow.Task.prototype.outputEval=function(a){return this.addOperation({what:"outputEval",eval:a.toString()})},Workflow.Task.Wait=function(a){Workflow.Task.call(this),this.data={wait:a||1e3}},Workflow.Script.prototype.wait=function(a){var b=new Workflow.Task.Wait(a);return this.tasks.push(b),null},Workflow.Task.Wait.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Wait.constructor=Workflow.Task.Wait,Workflow.Task.Wait.prototype.toString=function(){return"Wait "+this.data.wait+"ms"},Workflow.Task.Wait.prototype.execute=function(a,b){var c=this;setTimeout(b,c.data.wait)},Workflow.Task.Until=function(a,b,c){Workflow.Task.call(this),this.data={until:a,delay:b||1e3,times:c}},Workflow.Task.Until.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Until.constructor=Workflow.Task.Until,Workflow.Task.Until.prototype.toString=function(){return"Until "+this.data.until+" every"+("number"==typeof this.data.delay?" "+this.data.delay+"ms":"")+("number"==typeof this.data.times?" "+this.data.times+" times":"")},Workflow.Task.Until.prototype.execute=function(a,b){var c=this;if(!a.do)throw new Error("'do' is not supported in this context");if(this.data.with){var d=JSON.parse(JSON.stringify(this.data.with));input=d&&Workflow.with(a,d)}var e=this.data.times,f=function(){a._do(c.data.until,input,function(d,g){var h=c.runTests(a,d,g);return h.result?b(d,g,h):"number"==typeof e&&(e--,0>e)?b(d,g,h):(a.intermediateResult(c,d,g,h),void setTimeout(f,c.data.delay))})};f()},Workflow.Task.Do=function(a){Workflow.Task.call(this),this.data={"do":a}},Workflow.Task.Do.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Do.constructor=Workflow.Task.Do,Workflow.Task.Do.prototype.toString=function(){return"Do "+this.data.do+" with "+JSON.stringify(this.data.with)},Workflow.Task.Do.prototype.execute=function(a,b){var c,d=this;if(!a.do)throw new Error("'do' is not supported in this context");if(this.data.with){var e=JSON.parse(JSON.stringify(this.data.with));c=e&&Workflow.with(a,e)}a._do(this.data.do,c,function(c,e){var f=d.runTests(a,c,e);return b(c,e,f)})},Workflow.Task.Times=function(a,b){Workflow.Task.call(this),this.data={times:a},this.data.script=new Workflow.Script("Times:"+a),b(this.data.script)},Workflow.Task.Times.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Times.constructor=Workflow.Task.Times,Workflow.Task.Times.prototype.toString=function(){return"Execute block "+this.data.times+" times"},Workflow.Task.Times.prototype.execute=function(a,b){var c=this,d=this.data.times,e=function(){d>0?a.run(c.data.script,function(b,f){a.intermediateResult(c,b,f),d--,e()}):b(null,null)};e()},Workflow.Task.ForEach=function(a,b,c,d){Workflow.Task.call(this),this.data={},this.data.input=a,this.data.index=b,this.data.value=c,this.data.script=new Workflow.Script("ForEach:"+a),d(this.data.script)},Workflow.Task.ForEach.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.ForEach.constructor=Workflow.Task.ForEach,Workflow.Task.ForEach.prototype.toString=function(){return"ForEach "+this.data.input+" as "+this.data.index+" -> "+this.data.value},Workflow.Task.ForEach.prototype.execute=function(a,b){var c=this,d=this.data.input&&Workflow.with(a,[this.data.input]),e=0;if(d instanceof Array){e=0;var f=function(){return e<d.length?(a.saveValue(c.data.index,e),a.saveValue(c.data.value,d[e]),a.run(c.data.script,function(){e++,f()}),void 0):b(null,null)};f()}else{if("object"!=typeof d)throw new Error("Invalid iteration value:"+JSON.stringify(d));e=0;var g=Object.keys(d),h=function(){return e<g.length?(a.saveValue(c.data.index,g[e]),a.saveValue(c.data.value,d[g[e]]),a.run(c.data.script,function(){e++,h()}),void 0):b(null,null)};h()}},Workflow.Task.Use=function(a){Workflow.Task.call(this),this.data={},this.data.use=a},Workflow.Task.Use.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Use.constructor=Workflow.Task.Use,Workflow.Task.Use.prototype.execute=function(a,b){if(!a.use)throw new Error("'use' is not supported in this context");var c=this.data.use;c=c.replace(/\#{[^}]+}/g,function(b){return Workflow.resolve(a,b)}),a.use(c,function(c,d){a.api||(a.api={});for(var e in d)a.api[e]=d[e];return b(c,d)})},Workflow.Task.AsyncWait=function(a){Workflow.Task.call(this),this.data={},this.data.asyncWait=a},Workflow.Task.AsyncWait.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.AsyncWait.constructor=Workflow.Task.AsyncWait,Workflow.Task.AsyncWait.prototype.toString=function(){return"Async wait for group "+this.data.asyncWait},Workflow.Task.AsyncWait.prototype.execute=function(a,b){var c=this;if("undefined"!=typeof a.asyncGroups[c.data.asyncWait]){var d=function(){a.asyncGroups[c.data.asyncWait]>0?setTimeout(d,50):b()};d()}else b()},Workflow.Task.Get=function(a){Workflow.Task.call(this),this.data={},this.data.get=a},Workflow.Task.Get.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Get.constructor=Workflow.Task.Get,Workflow.Task.Get.prototype.toString=function(){return"Get "+this.data.get},Workflow.Task.Get.prototype.execute=function(a,b){var c=this;if(!a.get)throw new Error("'get' is not supported in this context'");var d={};if(this.data.with){var e=JSON.parse(JSON.stringify(this.data.with));d=e&&Workflow.with(a,e)}var f=this.data.get;console.log(this.data),f=f.replace(/\#{[^}]+}/g,function(b){return Workflow.resolve(a,b)}),console.log("URL",f),a.get(f,function(d,e){var f=c.runTests(a,d,e);b(d,e,f)})},Workflow.Task.Post=function(a){Workflow.Task.call(this),this.data={},this.data.post=a},Workflow.Task.Post.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Post.constructor=Workflow.Task.Post,Workflow.Task.Post.prototype.toString=function(){return"Post "+this.data.post},Workflow.Task.Post.prototype.execute=function(a,b){var c=this;if(!a.post)throw new Error("'post' is not supported in this context'");var d;if(this.data.with){var e=JSON.parse(JSON.stringify(this.data.with));d=e&&Workflow.with(a,e)}var f=this.data.post;f=f.replace(/\#{[^}]+}/g,function(b){return Workflow.resolve(a,b)}),a.post(f,d,function(d,e){var f=c.runTests(a,d,e);b(d,e,f)})},Workflow.Task.Put=function(a){Workflow.Task.call(this),this.data={},this.data.put=a},Workflow.Task.Put.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Put.constructor=Workflow.Task.Put,Workflow.Task.Put.prototype.toString=function(){return"Put "+this.data.put},Workflow.Task.Put.prototype.execute=function(a,b){var c=this;if(!a.put)throw new Error("'post' is not supported in this context'");var d;if(this.data.with){var e=JSON.parse(JSON.stringify(this.data.with));d=e&&Workflow.with(a,e)}var f=this.data.put;f=f.replace(/\#{[^}]+}/g,function(b){return Workflow.resolve(a,b)}),a.put(f,d,function(d,e){var f=c.runTests(a,d,e);b(d,e,f)})},Workflow.Task.Delete=function(a){Workflow.Task.call(this),this.data={},this.data.delete=a},Workflow.Task.Delete.prototype=Object.create(Workflow.Task.prototype),Workflow.Task.Delete.constructor=Workflow.Task.Delete,Workflow.Task.Delete.prototype.toString=function(){return"Delete "+this.data.delete},Workflow.Task.Delete.prototype.execute=function(a,b){var c=this;if(!a.delete)throw new Error("'post' is not supported in this context'");var d;if(this.data.with){var e=JSON.parse(JSON.stringify(this.data.with));d=e&&Workflow.with(a,e)}var f=this.data.delete;f=f.replace(/\#{[^}]+}/g,function(b){return Workflow.resolve(a,b)}),a.delete(f,d,function(d,e){var f=c.runTests(a,d,e);b(d,e,f)})},Workflow.Context=function(){this.stack=[],this.values={},this.asyncGroups={},this.api={},this.depth=0},Workflow.Context.prototype.saveValue=function(a,b){return this.values[a]=b,b},Workflow.Context.prototype.loadValue=function(name){if("string"==typeof name&&"undefined"!=typeof this.values)with(this.values)try{return eval(name)}catch(e){return void 0}return void 0},Workflow.Context.prototype._onStartTask=function(a){this.tasks++,this.onStartTask(a)},Workflow.Context.prototype._do=function(a,b,c){this.onTaskInput(b),this.do(a,b,c)},Workflow.Context.prototype._onCompleteTask=function(a,b,c,d){var e=this;d&&d.results.forEach(function(a){a.result===!0?e.pass++:e.fail++}),this.onCompleteTask(a,b,c,d)},Workflow.Context.prototype.summarize=function(){return{tasks:this.tasks,fail:this.fail,pass:this.pass,duration:this.finishTime-this.startTime}},Workflow.Context.prototype.setStepper=function(a){this.stepper=a},Workflow.Context.prototype.run=function(a,b){var c=this;0===this.depth&&(this.startTime=Date.now(),this.tasks=0,this.pass=0,this.fail=0,a.validate(this));var d=a.tasks,e=0,f=this.stepper||function(a){a()};this.depth++;var g=function(){if(e<d.length)d[e].run(c,function(){e++,f(g)});else{c.depth--,c.finishTime=Date.now();var h=c.summarize();0===c.depth&&c.log("("+a.name+")","tasks:",h.tasks,"pass",h.pass,"fail",h.fail),b(null,c.summarize())}};f(g)},Workflow.Context.prototype.get=function(){throw new Error("Not implemented")},Workflow.Context.prototype.post=function(){throw new Error("Not implemented")},Workflow.Context.prototype.put=function(){throw new Error("Not implemented")},Workflow.Context.prototype.delete=function(){throw new Error("Not implemented")},Workflow.Context.prototype.use=function(){throw new Error("Not implemented")},Workflow.Context.prototype.do=function(){throw new Error("Not implemented")},Workflow.Context.prototype.onStartTask=function(a){this.currentTask={task:a.toString()},this.logTaskStart(a.toString()),this.log("")},Workflow.Context.prototype.log=function(){for(var a=Array.prototype.slice.call(arguments),b="",c=0;c<this.depth;c++)b+="	";a.unshift(b),console.log.apply(console,a)},Workflow.Context.prototype.logTaskStart=Workflow.Context.prototype.log,Workflow.Context.prototype.logFail=Workflow.Context.prototype.log,Workflow.Context.prototype.logPass=Workflow.Context.prototype.log,Workflow.Context.prototype.onTaskInput=function(a){this.log("	Input:",JSON.stringify(a))},Workflow.Context.prototype.intermediateResult=function(a,b,c){("undefined"!=typeof b||"undefined"!=typeof c)&&this.log("	(Error:",b,"Result:",JSON.stringify(c),")")},Workflow.Context.prototype.onCompleteTask=function(a,b,c,d){var e=this;this.log("	Error",b),this.log("	Output",JSON.stringify(c)),this.log(""),d&&d.results.forEach(function(a){a.result?e.logPass("		",a.msg):e.logFail("		",a.msg)}),this.log("")},Workflow.msg=function(msg,options){with(options=options||{})return msg.replace(/#{([A-Za-z0-9\.\_]+)}/g,function(m,m1,m2){var r=eval(m1);return"object"==typeof r?JSON.stringify(r):r})},Workflow.pass=function(a,b){return{result:!0,msg:Workflow.msg(a,b)}},Workflow.fail=function(a,b){return{result:!1,msg:Workflow.msg(a,b)}},Workflow.utils={},Workflow.utils.objectCovers=function(a,b){var c,d=function(a,b){if(typeof a!=typeof b)return!1;if(a instanceof Array){for(var e in a){var f=!1;for(var g in b)d(a[e],b[g])&&(f=!0);if(!f)return!1}return!0}if("object"==typeof a){for(var h in a){if(null!==a&&null===b)return!1;if(typeof a[h]!=typeof b[h])return!1;if(a[h]instanceof Array){if(c=d(a[h],b[h]),c===!1)return!1}else if("object"==typeof a[h]){if(c=d(a[h],b[h]),c===!1)return!1}else if(a[h]!==b[h])return!1}return!0}return a===b};return d(a,b)},Workflow.utils.getProperty=function(object,property){if(null===object||void 0===object)return void 0;with(object)try{return eval(property)}catch(e){return void 0}},Workflow.utils.arrayContains=function(a,b){if(a instanceof Array)for(var c in a)if(Workflow.utils.objectCovers(b,a[c]))return!0;return!1},assert.equal(Workflow.utils.objectCovers([1,2,3,4],[1,2,3,4,5]),!0),assert.equal(Workflow.utils.objectCovers([1,2,3,4],[1,2,4,5]),!1),assert.equal(Workflow.utils.objectCovers("hello","hello"),!0),assert.equal(Workflow.utils.objectCovers({a:1},{a:1}),!0),assert.equal(Workflow.utils.objectCovers({a:1},{b:1}),!1),assert.equal(Workflow.utils.objectCovers({a:1,b:1},{a:1,b:1,c:3}),!0),assert.equal(Workflow.utils.objectCovers({a:1,b:{k:3}},{a:1,b:{k:3}}),!0),assert.equal(Workflow.utils.objectCovers({a:1,b:{k:3}},{a:1,b:{k:8}}),!1),assert.equal(Workflow.utils.objectCovers({a:1,b:{k:3},complex:[1,"3","A",{a:1},{b:5,c:[1,2,3,"5"]}]},{a:1,b:{k:3},complex:[1,"3","A",{a:1},{b:5,c:[1,2,3,"5"]}]}),!0),assert.equal(Workflow.utils.objectCovers({a:1,b:{k:3},complex:[1,"3","A",{a:1},{b:5,c:[1,2,3,"5"]}]},{a:1,b:{k:3}}),!1),assert.equal(Workflow.utils.objectCovers({a:1,b:{k:3},complex:[1,"3","A",{a:1},{b:5,c:[1,2,3,"5"]}]},{a:1,b:{k:3},complex:[1,"3","A",{a:1},{b:5,c:[1,2,3]}]}),!1),assert.equal(Workflow.utils.objectCovers([{name:"foo"},{name:"bar",roles:["a","b","c"],thing:{a:1,b:2}}],[{name:"foo"},{name:"bar",roles:["a","b","c"],thing:{a:1,b:2}}]),!0),assert.equal(Workflow.utils.objectCovers([{name:"foo"},{name:"bar",roles:["a","b","c"],thing:{a:1,b:2}}],[{name:"foo"},{name:"bar",roles:["a","b","c"],thing:{a:1,b:5}}]),!1),assert.equal(Workflow.utils.objectCovers([{name:"foo"},{name:"bar",roles:["a","b","c"],thing:{a:1,b:2}}],[{name:"bar",roles:["a","b","c"],thing:{a:1,b:5}}]),!1),Workflow.Tests={},Workflow.Tests.errorContains=function(a,b,c,d){return d&&(c=JSON.parse(JSON.stringify(c)),c.value=Workflow.resolve(d,c.value,!0)),null!==b?"string"==typeof b&&-1!=b.indexOf(c.value)?Workflow.pass("The error contained '#{value}'",c):Workflow.utils.objectCovers(c.value,b)?Workflow.pass("The error contained '#{value}'",c):Workflow.fail("The error did not contain '#{value}'",c):Workflow.fail("There was no error")},assert.deepEqual(Workflow.Tests.errorContains(null,null,{value:"ERROR"}),{result:!1,msg:"There was no error"}),assert.deepEqual(Workflow.Tests.errorContains(null,"ERROR",{value:"ERROR"}),{result:!0,msg:"The error contained 'ERROR'"}),assert.deepEqual(Workflow.Tests.errorContains(null,{what:"ERROR"},{value:{what:"ERROR"}}),{result:!0,msg:'The error contained \'{"what":"ERROR"}\''}),assert.deepEqual(Workflow.Tests.errorContains(null,"ERR",{value:"ERROR"}),{result:!1,msg:"The error did not contain 'ERROR'"}),Workflow.Tests.errorIsNull=function(a,b){return null===b?Workflow.pass("The error was null"):Workflow.fail("The error was not null")},assert.deepEqual(Workflow.Tests.errorIsNull(null,null),{result:!0,msg:"The error was null"}),assert.deepEqual(Workflow.Tests.errorIsNull(null,!0),{result:!1,msg:"The error was not null"}),Workflow.Tests.errorIsNotNull=function(a,b){return null===b?Workflow.fail("The error was null"):Workflow.pass("The error was not null")},assert.deepEqual(Workflow.Tests.errorIsNotNull(null,null),{result:!1,msg:"The error was null"}),assert.deepEqual(Workflow.Tests.errorIsNotNull(null,!0),{result:!0,msg:"The error was not null"}),Workflow.Tests.outputIsNull=function(a){return null===a?Workflow.pass("The output was null"):Workflow.fail("The output was not null")},assert.deepEqual(Workflow.Tests.outputIsNull(null),{result:!0,msg:"The output was null"}),assert.deepEqual(Workflow.Tests.outputIsNull(!0),{result:!1,msg:"The output was not null"}),Workflow.Tests.outputIsNotNull=function(a,b){return null===b?Workflow.fail("The output was null"):Workflow.pass("The output was not null")},assert.deepEqual(Workflow.Tests.outputIsNotNull(null,null),{result:!1,msg:"The output was null"}),assert.deepEqual(Workflow.Tests.outputIsNotNull(null,!0),{result:!0,msg:"The output was not null"}),Workflow.Tests.outputContains=function(a,b,c,d){return d&&(c=JSON.parse(JSON.stringify(c)),c.value=Workflow.resolve(d,c.value,!0)),Workflow.utils.objectCovers(c.value,a)?Workflow.pass("The output contained '#{value}'",c):Workflow.fail("The output did not contain '#{value}'",c)},assert.deepEqual(Workflow.Tests.outputContains(null,null,{value:null}),{result:!0,msg:"The output contained 'null'"}),assert.deepEqual(Workflow.Tests.outputContains("hello",null,{value:null}),{result:!1,msg:"The output did not contain 'null'"}),assert.deepEqual(Workflow.Tests.outputContains("wolf",null,{value:"wolf"}),{result:!0,msg:"The output contained 'wolf'"}),assert.deepEqual(Workflow.Tests.outputContains({a:1,b:2},null,{value:{a:1}}),{result:!0,msg:"The output contained '{\"a\":1}'"}),Workflow.Tests.outputDoesNotContain=function(a,b,c,d){return d&&(c=JSON.parse(JSON.stringify(c)),c.value=Workflow.resolve(d,c.value,!0)),Workflow.utils.objectCovers(c.value,a)?Workflow.fail("The output contained '#{value}'",c):Workflow.pass("The output did not contain '#{value}'",c)},assert.deepEqual(Workflow.Tests.outputDoesNotContain(null,null,{value:null}),{result:!1,msg:"The output contained 'null'"}),assert.deepEqual(Workflow.Tests.outputDoesNotContain("hello",null,{value:null}),{result:!0,msg:"The output did not contain 'null'"}),assert.deepEqual(Workflow.Tests.outputDoesNotContain("wolf",null,{value:"wolf"}),{result:!1,msg:"The output contained 'wolf'"}),assert.deepEqual(Workflow.Tests.outputDoesNotContain({a:1,b:2},null,{value:{a:1}}),{result:!1,msg:"The output contained '{\"a\":1}'"}),Workflow.Tests.outputIsArray=function(a){return a instanceof Array?Workflow.pass("The output was an array"):Workflow.fail("The output was not an array")},assert.deepEqual(Workflow.Tests.outputIsArray([],null,null),{result:!0,msg:"The output was an array"}),assert.deepEqual(Workflow.Tests.outputIsArray(null,null,null),{result:!1,msg:"The output was not an array"}),Workflow.Tests.arrayContains=function(a,b,c,d){if(d&&(c=JSON.parse(JSON.stringify(c)),c.value=Workflow.resolve(d,c.value,!0)),null!==a){var e=Workflow.utils.getProperty(a,c.property);return e instanceof Array?Workflow.utils.arrayContains(e,c.value)?Workflow.pass("The array property '#{property}' contained '#{value}'",c):Workflow.fail("The array property '#{property}' did not contain '#{value}'",c):Workflow.fail("The array property '#{property}' was not an array",c)}return Workflow.fail("The output was null")},assert.deepEqual(Workflow.Tests.arrayContains(null,null,{property:"foo",value:1}),{result:!1,msg:"The output was null"}),assert.deepEqual(Workflow.Tests.arrayContains({foo:null},null,{property:"foo",value:1}),{result:!1,msg:"The array property 'foo' was not an array"}),assert.deepEqual(Workflow.Tests.arrayContains({foo:[1]},null,{property:"foo",value:1}),{result:!0,msg:"The array property 'foo' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayContains({foo:[3,4,6,"s",null,1]},null,{property:"foo",value:1}),{result:!0,msg:"The array property 'foo' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayContains({foo:{bar:[3,4,6,"s",null,1]}},null,{property:"foo.bar",value:1}),{result:!0,msg:"The array property 'foo.bar' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayContains({foo:[2]},null,{property:"foo",value:1}),{result:!1,msg:"The array property 'foo' did not contain '1'"}),Workflow.Tests.arrayLengthIs=function(a,b,c,d){if(d&&(c=JSON.parse(JSON.stringify(c)),c.min=Workflow.resolve(d,c.min,!0),c.max=Workflow.resolve(d,c.max,!0)),null===a)return Workflow.fail("The output was null");var e=Workflow.utils.getProperty(a,c.property);if(e instanceof Array){if("undefined"!=typeof c.min&&e.length<c.min)return Workflow.fail("The array '#{property}' length was < #{min}",c);if("undefined"!=typeof c.max&&e.length>c.max)return Workflow.fail("The array '#{property}' length was > #{max}",c);if("undefined"!=typeof c.min&&"undefined"!=typeof c.max)return Workflow.pass("The array '#{property}' length was between #{min} and #{max}",c);if("undefined"!=typeof c.min)return Workflow.pass("The array '#{property}' length was > #{min}",c);if("undefined"!=typeof c.max)return Workflow.pass("The array '#{property}' length was < #{max}",c)}return Workflow.fail("The property #{property} is not an array",c)},assert.deepEqual(Workflow.Tests.arrayLengthIs(null,null,{property:"foo",value:1}),{result:!1,msg:"The output was null"}),assert.deepEqual(Workflow.Tests.arrayLengthIs({foo:[1,2,3,4,5]},null,{property:"foo",min:1}),{result:!0,msg:"The array 'foo' length was > 1"}),assert.deepEqual(Workflow.Tests.arrayLengthIs({foo:[1,2,3,4,5]},null,{property:"foo",min:10}),{result:!1,msg:"The array 'foo' length was < 10"}),assert.deepEqual(Workflow.Tests.arrayLengthIs({foo:[1,2,3,4,5]},null,{property:"foo",max:1}),{result:!1,msg:"The array 'foo' length was > 1"}),assert.deepEqual(Workflow.Tests.arrayLengthIs({foo:[1,2,3,4,5]},null,{property:"foo",max:10}),{result:!0,msg:"The array 'foo' length was < 10"}),assert.deepEqual(Workflow.Tests.arrayLengthIs({foo:[1,2,3,4,5]},null,{property:"foo",min:1,max:10}),{result:!0,msg:"The array 'foo' length was between 1 and 10"}),Workflow.Tests.arrayDoesntContain=function(a,b,c,d){if(d&&(c=JSON.parse(JSON.stringify(c)),c.value=Workflow.resolve(d,c.value,!0)),null!==a){var e=Workflow.utils.getProperty(a,c.property);return e instanceof Array?Workflow.utils.arrayContains(e,c.value)?Workflow.fail("The array property '#{property}' contained '#{value}'",c):Workflow.pass("The array property '#{property}' did not contain '#{value}'",c):Workflow.fail("The array property '#{property}' was not an array",c)}return Workflow.fail("The output was null")},assert.deepEqual(Workflow.Tests.arrayDoesntContain(null,null,{property:"foo",value:1}),{result:!1,msg:"The output was null"}),assert.deepEqual(Workflow.Tests.arrayDoesntContain({foo:null},null,{property:"foo",value:1}),{result:!1,msg:"The array property 'foo' was not an array"}),assert.deepEqual(Workflow.Tests.arrayDoesntContain({foo:[1]},null,{property:"foo",value:1}),{result:!1,msg:"The array property 'foo' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayDoesntContain({foo:[3,4,6,"s",null,1]},null,{property:"foo",value:1}),{result:!1,msg:"The array property 'foo' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayDoesntContain({foo:{bar:[3,4,6,"s",null,1]}},null,{property:"foo.bar",value:1}),{result:!1,msg:"The array property 'foo.bar' contained '1'"}),assert.deepEqual(Workflow.Tests.arrayDoesntContain({foo:[2]},null,{property:"foo",value:1}),{result:!0,msg:"The array property 'foo' did not contain '1'"}),Workflow.Tests.propertyIsNull=function(a,b,c){if(a){var d=Workflow.utils.getProperty(a,c.property);return null===d?Workflow.pass("The property '#{property}' was null",c):Workflow.fail("The property '#{property}' was not null",c)}return Workflow.fail("The output was null",c)},assert.deepEqual(Workflow.Tests.propertyIsNull({foo:"hello"},null,{property:"foo"}),{result:!1,msg:"The property 'foo' was not null"}),assert.deepEqual(Workflow.Tests.propertyIsNull({foo:null},null,{property:"foo"}),{result:!0,msg:"The property 'foo' was null"}),assert.deepEqual(Workflow.Tests.propertyIsNull(null,null,{property:"foo"}),{result:!1,msg:"The output was null"}),Workflow.Tests.propertyIsNotNull=function(a,b,c){if(a){var d=Workflow.utils.getProperty(a,c.property);return null!==d?Workflow.pass("The property '#{property}' was not null",c):Workflow.fail("The property '#{property}' was null",c)}return Workflow.fail("The output was null",c)},assert.deepEqual(Workflow.Tests.propertyIsNotNull({foo:"hello"},null,{property:"foo"}),{result:!0,msg:"The property 'foo' was not null"}),assert.deepEqual(Workflow.Tests.propertyIsNotNull({foo:null},null,{property:"foo"}),{result:!1,msg:"The property 'foo' was null"}),assert.deepEqual(Workflow.Tests.propertyIsNotNull(null,null,{property:"foo"}),{result:!1,msg:"The output was null"}),Workflow.Tests.propertyContains=function(a,b,c,d){if(a){d&&(c=JSON.parse(JSON.stringify(c)),c.value=Workflow.resolve(d,c.value,!0));var e=Workflow.utils.getProperty(a,c.property);return Workflow.utils.objectCovers(c.value,e)?Workflow.pass("The property '#{property}' contained '#{value}'",c):Workflow.fail("The property '#{property}' did not contain '#{value}'",c)}return Workflow.fail("The output was null",c)},assert.deepEqual(Workflow.Tests.propertyContains({foo:"hello"},null,{property:"foo",value:"hello"}),{result:!0,msg:"The property 'foo' contained 'hello'"}),assert.deepEqual(Workflow.Tests.propertyContains({foo:"hello"},null,{property:"foo",value:"goodbye"}),{result:!1,msg:"The property 'foo' did not contain 'goodbye'"}),assert.deepEqual(Workflow.Tests.propertyContains(null,null,{property:"foo"}),{result:!1,msg:"The output was null"}),Workflow.Tests.propertyDoesntContain=function(a,b,c,d){if(a){d&&(c=JSON.parse(JSON.stringify(c)),c.value=Workflow.resolve(d,c.value,!0));var e=Workflow.utils.getProperty(a,c.property);return Workflow.utils.objectCovers(c.value,e)?Workflow.pass("The property '#{property}' did not contain '#{value}'",c):Workflow.fail("The property '#{property}' contained '#{value}'",c)}return Workflow.fail("The output was null",c)},assert.deepEqual(Workflow.Tests.propertyDoesntContain({foo:"hello"},null,{property:"foo",value:"hello"}),{result:!0,msg:"The property 'foo' did not contain 'hello'"}),assert.deepEqual(Workflow.Tests.propertyDoesntContain({foo:"hello"},null,{property:"foo",value:"goodbye"}),{result:!1,msg:"The property 'foo' contained 'goodbye'"}),assert.deepEqual(Workflow.Tests.propertyDoesntContain(null,null,{property:"foo"}),{result:!1,msg:"The output was null"}),Workflow.Tests.propertyIsArray=function(a,b,c){if(a){var d=Workflow.utils.getProperty(a,c.property);return d instanceof Array?Workflow.pass("The property '#{property}' was an array",c):Workflow.fail("The property '#{property}' was not an array",c)
}return Workflow.fail("The output was null",c)},assert.deepEqual(Workflow.Tests.propertyIsArray({foo:["hello"]},null,{property:"foo"}),{result:!0,msg:"The property 'foo' was an array"}),assert.deepEqual(Workflow.Tests.propertyIsArray({foo:"hello"},null,{property:"foo"}),{result:!1,msg:"The property 'foo' was not an array"}),assert.deepEqual(Workflow.Tests.propertyIsArray(null,null,{property:"foo"}),{result:!1,msg:"The output was null"}),Workflow.Tests.saveOutputAs=function(a,b,c,d){return b?Workflow.fail("The value was not saved, because an error occured"):(d.saveValue(c.name,a),Workflow.pass("The result was saved as '#{name}'",c))},Workflow.Tests.savePropertyAs=function(a,b,c,d){if(!b){var e=Workflow.utils.getProperty(a,c.property);return d.saveValue(c.name,e),Workflow.pass("The property '#{property}' was saved as '#{name}'",c)}return Workflow.fail("The value was not saved, because an error occured")},Workflow.Tests.outputEval=function(a,b,c,d){if(!b){"function"==typeof c.eval&&(c.eval=c.eval.toString()),c=JSON.parse(JSON.stringify(c)),c.eval=new Function("return ("+c.eval+")");var e=c.eval()(b,a,d);return e===!0?Workflow.pass("The evaluation function returned true"):Workflow.fail("The evaluation function did not return true, it returned '#{result}'",{result:e})}return Workflow.fail("The output was null")},assert.deepEqual(Workflow.Tests.outputEval(null,null,{eval:"function(){ return true; }"}),{result:!0,msg:"The evaluation function returned true"}),assert.deepEqual(Workflow.Tests.outputEval(null,null,{eval:"function(){ return false; }"}),{result:!1,msg:"The evaluation function did not return true, it returned 'false'"}),Workflow.Context.prototype.use=function(a,b){$.getScript(a+"api/api.js",function(a,c,d){return 200==d.status?b(null,!0):b(c)})},Workflow.Context.prototype.do=function(method,input,onComplete){eval(method)(input,onComplete)},Workflow.Context.prototype.get=function(a,b){$.ajax({url:a,type:"GET"}).done(function(a,c,d){return a&&d.status>=200&&d.status<300?b(null,a):b(d.responseText)}).fail(function(a){return b(a.responseText)})},Workflow.Context.prototype.post=function(a,b,c){$.ajax({url:a,type:"POST",dataType:"json",data:JSON.stringify(b),contentType:"application/json"}).done(function(a,b,d){return a&&d.status>=200&&d.status<300?c(null,a):c(d.responseText)}).fail(function(a){return c(a.responseText)})},Workflow.Context.prototype.put=function(a,b,c){$.ajax({url:a,type:"PUT",dataType:"json",data:JSON.stringify(b),contentType:"application/json"}).done(function(a,b,d){return a&&d.status>=200&&d.status<300?c(null,a):c(d.responseText)}).fail(function(a){return c(a.responseText)})},Workflow.Context.prototype.delete=function(a,b,c){$.ajax({url:a,type:"DELETE"}).done(function(a,b,d){return a&&d.status>=200&&d.status<300?c(null,a):c(d.responseText)}).fail(function(a){return c(a.responseText)})},Workflow.Context.setSelector=function(a){this.selector=a},Workflow.Context.prototype.log=function(){var a=Array.prototype.slice.call(arguments);a=a.map(function(a){return"string"==typeof a?a:JSON.stringify(a)});for(var b="",c=0;c<this.depth;c++)b+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";str=b+a.join(" "),str=str.replace("	","&nbsp;&nbsp;&nbsp;"),str+="</br>",$(this.selector||"body").append(str)},Workflow.Context.prototype.logTaskStart=function(){var a=Array.prototype.slice.call(arguments);a=a.map(function(a){return"string"==typeof a?"<b>"+a+"</b>":a}),Workflow.Context.prototype.log.apply(this,a)},Workflow.Context.prototype.logFail=function(){var a=Array.prototype.slice.call(arguments);a=a.map(function(a){return"string"==typeof a?"<font color='red'>"+a+"</font>":a}),Workflow.Context.prototype.log.apply(this,a)},Workflow.Context.prototype.logPass=function(){var a=Array.prototype.slice.call(arguments);a=a.map(function(a){return"string"==typeof a?"<font color='green'>"+a+"</font>":a}),Workflow.Context.prototype.log.apply(this,a)};